<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CMG Consultoria - Acesso</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
    <style>
        :root {
            --primary-color: #0a0239;
            --primary-light: #F0EFFF;
            --background-color: #f9fafb;
            --sidebar-bg: #ffffff;
            --card-bg: #ffffff;
            --text-dark: #1f2937;
            --text-light: #6b7280;
            --border-color: #e5e7eb;
            --shadow-color: rgba(13, 13, 111, 0.08);
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --blue-check: #22c55e;
            --blue-light: #eff6ff;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Poppins', sans-serif; background-color: var(--background-color); color: var(--text-dark); }
        
        #login-screen { display: flex; justify-content: center; align-items: center; min-height: 100vh; padding: 20px; }
        #login-container { background: var(--card-bg); padding: 40px; border-radius: 16px; box-shadow: 0 8px 30px rgba(0,0,0,0.1); width: 100%; max-width: 450px; text-align: center; }
        .company-logo { max-width: 120px; margin-bottom: 20px; }
        h1 { font-size: 24px; font-weight: 600; margin-bottom: 8px; }
        #login-container p { color: var(--text-light); margin-bottom: 25px; }
        .input-field { width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; font-size: 16px; transition: all 0.3s; }
        .input-field:focus { outline: none; border-color: var(--primary-color); box-shadow: 0 0 0 3px var(--primary-light); }
        .input-wrapper { display: flex; flex-direction: column; gap: 15px; margin-bottom: 20px; }
        .action-button, .form-button { width: 100%; padding: 12px 25px; border: none; background: var(--primary-color); color: white; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: 500; transition: background-color 0.3s; }
        #error-message { color: var(--danger-color); font-size: 14px; height: 20px; margin-top: 10px; }

        .app-layout { display: none; grid-template-columns: 260px 1fr; min-height: 100vh; }
        .sidebar { background-color: var(--sidebar-bg); padding: 24px; border-right: 1px solid var(--border-color); display: flex; flex-direction: column; }
        .sidebar-header { margin-bottom: 30px; }
        .sidebar-header .company-logo { max-width: 50px; }
        .sidebar nav { flex-grow: 1; }
        .sidebar ul { list-style: none; }
        .sidebar li a { display: flex; align-items: center; gap: 12px; padding: 12px 16px; border-radius: 8px; text-decoration: none; color: var(--text-light); font-weight: 500; margin-bottom: 8px; transition: all 0.3s; }
        .sidebar li a svg { width: 20px; height: 20px; stroke: var(--text-light); transition: all 0.3s; }
        .sidebar li a:hover { background-color: var(--primary-light); color: var(--primary-color); }
        .sidebar li a.active { background-color: var(--primary-color); color: white; }
        .sidebar li a.active svg { stroke: white; }
        .sidebar-footer { margin-top: auto; padding-top: 20px; border-top: 1px solid var(--border-color); }
        .logout-button { background: none; border: none; cursor: pointer; display: inline-flex; align-items: center; gap: 12px; padding: 10px; border-radius: 8px; font-family: 'Poppins', sans-serif; font-size: 15px; font-weight: 500; color: var(--text-light); transition: all 0.3s; }
        .main-content { background-color: var(--background-color); padding: 24px 32px; overflow-y: auto; }
        .main-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; flex-wrap: wrap; gap: 16px; }
        .main-header h1 { font-size: 28px; flex-grow: 1; text-align: left; }
        .user-profile { display: flex; align-items: center; gap: 12px; }
        .user-profile span { font-weight: 600; }
        .summary-cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 24px; }
        .summary-card { background-color: var(--card-bg); padding: 20px; border-radius: 12px; box-shadow: 0 4px 12px var(--shadow-color); display: flex; align-items: flex-start; gap: 16px; }
        .summary-card .icon { width: 48px; height: 48px; border-radius: 8px; display: flex; justify-content: center; align-items: center; flex-shrink: 0; }
        .summary-card .icon svg { width: 24px; height: 24px; }
        .summary-card .text { overflow: hidden; }
        .summary-card .text h3 { font-size: 14px; color: var(--text-light); margin-bottom: 4px; font-weight: 500; white-space: nowrap; }
        .summary-card .text p { font-size: 20px; font-weight: 600; text-overflow: ellipsis; white-space: nowrap; overflow: hidden; }
        .dashboard-grid { display: grid; grid-template-columns: 1fr; gap: 24px; margin-top: 24px;}
        .dashboard-card { background-color: var(--card-bg); padding: 24px; border-radius: 12px; box-shadow: 0 4px 12px var(--shadow-color); }
        .dashboard-card h2 { font-size: 18px; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 1px solid var(--border-color); }
        .timeline { display: flex; justify-content: space-between; position: relative; padding: 20px 0; }
        .timeline::before { content: ''; position: absolute; top: 52px; left: 10%; right: 10%; height: 4px; background-color: var(--border-color); z-index: 1; }
        #progress-bar { position: absolute; top: 52px; left: 10%; height: 4px; background-color: var(--primary-color); width: 0%; z-index: 2; transition: width 0.5s ease-in-out; }
        .step { display: flex; flex-direction: column; align-items: center; text-align: center; width: 120px; position: relative; z-index: 3; }
        .step-icon { width: 60px; height: 60px; border-radius: 50%; background-color: #ccc; display: flex; justify-content: center; align-items: center; margin-bottom: 10px; border: 4px solid var(--background-color); transition: all 0.3s; }
        .step-icon svg { width: 30px; height: 30px; fill: white; }
        .step-content .step-title { font-weight: 600; font-size: 14px; }
        .step-content .step-description { font-size: 12px; color: var(--text-light); }
        .step.active .step-icon { background-color: var(--primary-color); }
        .step.completed .step-icon { background-color: var(--success-color); }
        #status-message { margin-top: 20px; padding: 15px; background-color: var(--primary-light); border: 1px solid #dcd5f8; border-radius: 8px; color: #6A5ACD; font-size: 15px; font-weight: 500; }
        #materiais-list { list-style: none; padding: 0; }
        #materiais-list li { margin-bottom: 10px; }
        #materiais-list a { text-decoration: none; color: var(--primary-color); font-weight: 500; }
        .plans-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 24px; margin-top: 24px; }
        .plan-card { background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 12px; padding: 32px; text-align: center; display: flex; flex-direction: column; position: relative; box-shadow: 0 4px 12px var(--shadow-color); transition: all 0.3s ease; }
        .plan-card.popular { border: 2px solid var(--primary-color); transform: scale(1.02); box-shadow: 0 8px 20px rgba(10, 2, 57, 0.15); }
        .plan-badge { position: absolute; top: -16px; left: 50%; transform: translateX(-50%); background: var(--blue-light); color: var(--primary-color); padding: 6px 16px; border-radius: 20px; font-size: 13px; font-weight: 600; white-space: nowrap; }
        .plan-card h3 { font-size: 22px; margin-bottom: 8px; color: var(--text-dark); }
        .plan-card .description { color: var(--text-light); margin-bottom: 24px; min-height: 40px; font-size: 15px; }
        .plan-price { margin-bottom: 24px; }
        .plan-price .currency { font-size: 24px; font-weight: 500; color: var(--text-light); vertical-align: super; margin-right: 2px; }
        .plan-price .amount { font-size: 48px; font-weight: 700; color: var(--primary-color); line-height: 1; }
        .plan-price .period { font-size: 16px; color: var(--text-light); margin-left: 4px; }
        .plan-features { list-style: none; text-align: left; margin-bottom: 32px; flex-grow: 1; padding: 0; }
        .plan-features li { margin-bottom: 12px; display: flex; align-items: flex-start; gap: 10px; color: var(--text-dark); font-size: 15px; line-height: 1.4; }
        .plan-features li svg { width: 20px; height: 20px; color: var(--blue-check); flex-shrink: 0; margin-top: 2px; }
        .plan-button { padding: 14px 25px; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s; text-decoration: none; display: block; width: 100%; }
        .plan-button.primary { background: var(--primary-color); color: white; border: none; }
        .plan-button.primary:hover { background: #5849b0; transform: translateY(-2px); box-shadow: 0 6px 15px rgba(10, 2, 57, 0.2); }
        .plan-button.secondary { background: white; color: var(--primary-color); border: 1px solid var(--primary-color); }
        .plan-button.secondary:hover { background: var(--primary-light); transform: translateY(-2px); box-shadow: 0 6px 15px rgba(10, 2, 57, 0.1); }
        .announcement-card { background-color: var(--primary-light); border-left: 5px solid var(--primary-color); margin-top: 24px; }
        .payment-card { background-color: var(--card-bg); border-radius: 12px; padding: 24px; box-shadow: 0 4px 12px var(--shadow-color); text-align: center; }
        .payment-card.overdue { border-left: 5px solid var(--danger-color); }
        .payment-card.ok { border-left: 5px solid var(--success-color); }
        .payment-card h3 { font-size: 18px; margin-bottom: 8px; }
        .payment-card p { color: var(--text-light); margin-bottom: 20px; }
        .payment-card .amount { font-size: 36px; font-weight: 700; color: var(--primary-color); margin-bottom: 20px; }
        .payment-card .pay-button { background-color: var(--success-color); color: white; border: none; padding: 12px 30px; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; transition: background-color 0.3s; }
        .consulta-card { max-width: 600px; margin: 0 auto; }
        .form-group { margin-bottom: 15px; text-align: left; }
        .form-group label { display: block; font-weight: 500; margin-bottom: 5px; }
        .form-group .input-field { width: 100%; }
        .form-button { margin-top: 10px; }
        #form-status { margin-top: 15px; font-weight: 500; }
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.6); display: none; justify-content: center; align-items: center; z-index: 1000; }
        .modal-content { background: white; padding: 30px; border-radius: 16px; text-align: center; max-width: 400px; width: 90%; position: relative; }
        .modal-content h2 { margin-bottom: 15px; font-size: 20px; }
        .modal-content #qrcode-container { margin: 20px auto; width: 200px; height: 200px; }
        .pix-copy-area { display: flex; align-items: center; gap: 10px; margin-top: 15px; }
        .pix-copy-area #pix-code { flex-grow: 1; padding: 8px; font-size: 12px; text-align: center; border: 1px solid var(--border-color); border-radius: 8px; background-color: var(--background-color); }
        #copy-pix-btn { padding: 8px 12px; border: 1px solid var(--border-color); background-color: #fff; border-radius: 8px; cursor: pointer; font-weight: 500; }
        .modal-content .whatsapp-button { display: inline-block; background: #25D366; color: white; padding: 10px 20px; border-radius: 8px; text-decoration: none; font-weight: 500; margin-top: 20px; }
        .close-modal { position: absolute; top: 10px; right: 15px; font-size: 28px; cursor: pointer; color: var(--text-light); }
        
        #admin-dashboard-view { display: none; padding: 24px; }
        .kpi-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 24px; margin-bottom: 24px; }
        .kpi-card { background-color: var(--card-bg); padding: 20px; border-radius: 12px; box-shadow: 0 4px 12px var(--shadow-color); }
        .kpi-card h3 { font-size: 15px; color: var(--text-light); margin-bottom: 8px; font-weight: 500; }
        .kpi-card p { font-size: 28px; font-weight: 700; color: var(--primary-color); }
        .admin-grid { display: grid; grid-template-columns: 2fr 1fr; gap: 24px; }
        #search-input { width: 100%; padding: 10px 15px; border: 1px solid var(--border-color); border-radius: 8px; font-size: 15px; margin-bottom: 20px; }
        .table-container { max-height: 500px; overflow-y: auto; }
        #client-table { width: 100%; border-collapse: collapse; }
        #client-table th, #client-table td { padding: 12px 15px; text-align: left; border-bottom: 1px solid var(--border-color); }
        #client-table th { background-color: var(--primary-light); color: var(--primary-color); font-weight: 600; font-size: 14px; position: sticky; top: 0; z-index: 10; }
        #client-table td { font-size: 14px; }
        #client-table tr:hover { background-color: #f9fafb; }
        .payment-status-pending { color: var(--danger-color); font-weight: 500; }
        .payment-status-ok { color: var(--success-color); }
        .client-links a { color: var(--primary-color); text-decoration: none; margin-right: 10px; }
        .client-links a:hover { text-decoration: underline; }
        #admin-logout-btn { background-color: var(--danger-color); color: white; padding: 8px 16px; border-radius: 8px; text-decoration: none; font-weight: 500; }

        .payment-history-card { background-color: var(--card-bg); padding: 24px; border-radius: 12px; box-shadow: 0 4px 12px var(--shadow-color); }
        .payment-history-card h2 { font-size: 18px; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 1px solid var(--border-color); }
        .history-table-container { overflow-x: auto; }
        .payment-history-table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        .payment-history-table th, .payment-history-table td { padding: 12px 15px; text-align: left; border-bottom: 1px solid var(--border-color); }
        .payment-history-table th { font-weight: 600; font-size: 14px; color: var(--text-light); }
        .payment-history-table td { font-size: 15px; }
        .status-badge { padding: 4px 10px; border-radius: 12px; font-weight: 600; font-size: 12px; color: white; white-space: nowrap; }
        .status-pago { background-color: var(--success-color); }
        .status-pendente { background-color: var(--danger-color); }
        .regularizar-btn { background-color: var(--warning-color); color: white; border: none; padding: 8px 16px; border-radius: 6px; font-size: 14px; font-weight: 500; cursor: pointer; transition: background-color 0.3s; }
        .regularizar-btn:hover { background-color: #d97706; }
        .no-payments-message { text-align: center; padding: 40px; background-color: #f9fafb; border-radius: 8px; }
        .no-payments-message p { font-size: 16px; color: var(--text-light); }
        .placeholder-content { text-align: center; padding: 60px 20px; background-color: #f9fafb; border-radius: 8px;}
        .placeholder-content svg { width: 60px; height: 60px; color: var(--border-color); margin-bottom: 20px; }
        .placeholder-content p { font-size: 18px; color: var(--text-light); }

        .mobile-menu-button { display: none; background: none; border: none; cursor: pointer; padding: 5px; z-index: 1003; }
        .close-menu-button { display: none; position: absolute; top: 15px; right: 15px; background: none; border: none; cursor: pointer; color: var(--text-light); }
        #menu-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); z-index: 1001; opacity: 0; transition: opacity 0.3s ease-in-out; }
        #menu-overlay.open { display: block; opacity: 1; }
        .sidebar.open { transform: translateX(0); }
        
        @media (max-width: 992px) {
            .admin-grid { grid-template-columns: 1fr; }
        }
        
        @media (max-width: 768px) {
            /* --- AJUSTES GERAIS DE LAYOUT --- */
            .app-layout { grid-template-columns: 1fr; }
            .main-content, #admin-dashboard-view, .dashboard-card { padding: 16px; }
            #login-container { padding: 24px 20px; }
            
            /* --- CABEÇALHO E MENU MOBILE --- */
            .sidebar { 
                position: fixed; left: 0; top: 0; height: 100%; 
                transform: translateX(-100%); transition: transform 0.3s ease-in-out; 
                z-index: 1002; width: 260px; box-shadow: 0 0 20px rgba(0,0,0,0.1); 
            }
            .main-header { flex-wrap: wrap; justify-content: space-between; align-items: center; }
            .main-header h1 { order: 2; width: 100%; text-align: center; margin-top: 10px; font-size: 22px; }
            .user-profile { order: 3; }
            .mobile-menu-button { display: block; order: 1; width: 44px; height: 44px; padding: 8px; color: var(--text-dark); }
            .mobile-menu-button svg { width: 100%; height: 100%; }
            .close-menu-button { display: block; }

            /* --- AJUSTES NOS CARDS E GRIDS --- */
            .summary-cards, .plans-container { gap: 16px; }
            .summary-card .text p { font-size: 18px; }

            /* --- TIMELINE VERTICAL --- */
            .timeline { flex-direction: column; align-items: flex-start; margin: 0; padding: 0; }
            .timeline::before, #progress-bar { left: 32px; right: auto; top: 0; width: 4px; height: 100%; }
            #progress-bar { transition: height 0.5s ease-in-out; height: 0; }
            .step { flex-direction: row; text-align: left; width: 100%; margin-bottom: 30px; }
            .step-icon { margin-right: 15px; }

            /* --- TABELA RESPONSIVA (FORMATO DE CARD) --- */
            #client-table { border: 0; }
            #client-table thead { display: none; }
            #client-table tr { 
                display: block; margin-bottom: 16px; background-color: var(--card-bg); 
                border-radius: 8px; box-shadow: 0 2px 8px var(--shadow-color); border: 1px solid var(--border-color); 
            }
            #client-table td { 
                display: block; text-align: right; position: relative; 
                padding-left: 50%; border-bottom: 1px solid var(--border-color); word-break: break-word;
            }
            #client-table td:last-child { border-bottom: 0; }
            #client-table td::before { 
                content: attr(data-label); position: absolute; left: 15px; 
                font-weight: 600; color: var(--text-dark); text-align: left; 
            }

            /* --- AJUSTE MODAL DE PAGAMENTO --- */
            .modal-content { padding: 24px; }
            .modal-content #qrcode-container { width: 180px; height: 180px; }
            .pix-copy-area #pix-code { font-size: 11px; }
        }
    </style>
</head>
<body>

    <div id="login-screen">
        <div id="login-container">
            <img src="img/Logo.png" alt="Logo" class="company-logo">
            <h1>Bem-vindo à CMG Consultoria</h1>
            <p>Acesse sua área de cliente, parceiro ou administrador.</p>
            <div class="input-wrapper">
                <input type="text" id="docInput" class="input-field" placeholder="CPF, CNPJ ou Usuário">
                <input type="password" id="passwordInput" class="input-field" placeholder="Sua senha">
            </div>
            <button id="loginButton" class="action-button">Entrar</button>
            <p id="error-message"></p>
        </div>
    </div>

    <div id="app-layout" class="app-layout">
        <aside class="sidebar">
            <button class="close-menu-button" id="client-close-menu-button"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M18 6L6 18M6 6l12 12"></path></svg></button>
            <div class="sidebar-header"><img src="img/Logo.png" alt="Logo" class="company-logo"></div>
            <nav><ul id="client-nav-ul"></ul></nav>
            <div class="sidebar-footer">
                <button class="logout-button"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/></svg>Sair</button>
            </div>
        </aside>

        <main class="main-content">
            <header class="main-header">
                <button class="mobile-menu-button" id="client-mobile-menu-button"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M3 12h18M3 6h18M3 18h18"></path></svg></button>
                <h1 id="page-title"></h1>
                <div class="user-profile"><span id="username-display"></span></div>
            </header>
            <div id="dashboard-view" class="view-content" style="display: none;"></div>
            <div id="payments-view" class="view-content" style="display: none;"></div>
            <div id="consultas-view" class="view-content" style="display: none;"></div>
            <div id="plans-view" class="view-content" style="display: none;"></div>
            <div id="credit-card-view" class="view-content" style="display: none;"></div>
        </main>
    </div>

    <div id="admin-dashboard-view">
        <header style="margin-bottom: 24px; display: flex; justify-content: space-between; align-items: center;">
            <h1 style="font-size: 28px;">Dashboard do Administrador</h1>
            <a href="#" id="admin-logout-btn">Sair</a>
        </header>
        <section class="kpi-grid">
            <div class="kpi-card"><h3>Total de Clientes</h3><p id="kpi-total-clients">0</p></div>
            <div class="kpi-card"><h3>Processos Iniciais</h3><p id="kpi-pending-clients">0</p></div>
            <div class="kpi-card"><h3>Processos Finalizados</h3><p id="kpi-finished-clients">0</p></div>
            <div class="kpi-card"><h3>Receita a Receber</h3><p id="kpi-revenue-pending">R$ 0,00</p></div>
        </section>
        <section class="admin-grid">
            <div class="dashboard-card">
                <h2>Feedback de Clientes</h2>
                <input type="text" id="search-input" placeholder="Pesquisar por nome, CPF, status...">
                <div class="table-container">
                    <table id="client-table">
                        <thead><tr><th>Cliente</th><th>Documento</th><th>Status</th><th>Pagamento</th><th>Links</th></tr></thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
            <div class="dashboard-card">
                <h2>Visão Financeira</h2>
                <div style="position: relative; height: 300px;">
                    <canvas id="financial-chart"></canvas>
                </div>
            </div>
        </section>
    </div>

    <div id="partner-dashboard-view" class="app-layout">
        <aside class="sidebar">
             <button class="close-menu-button" id="partner-close-menu-button"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M18 6L6 18M6 6l12 12"></path></svg></button>
            <div class="sidebar-header"><img src="img/Logo.png" alt="Logo" class="company-logo"></div>
            <nav><ul id="partner-nav-ul"></ul></nav>
             <div class="sidebar-footer">
                 <button class="logout-button" id="partner-logout-btn"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path></svg>Sair</button>
            </div>
        </aside>

        <main class="main-content">
             <header class="main-header">
                <button class="mobile-menu-button" id="partner-mobile-menu-button"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M3 12h18M3 6h18M3 18h18"></path></svg></button>
                <h1 id="partner-page-title"></h1>
                 <div class="user-profile"><span id="partner-username-display"></span></div>
            </header>
            
            <div id="partner-consultas-view" class="partner-view-content">
                <div class="dashboard-card consulta-card">
                    <h2>Nova Consulta de Crédito</h2>
                    <p style="color: var(--text-light); margin-top: -15px; margin-bottom: 25px;">Selecione o tipo de consulta, informe o documento e prossiga para o pagamento.</p>
                    <form id="partner-consulta-form">
                        <div class="form-group" style="margin-bottom: 20px;">
                            <label for="consulta-type-select">Tipo de Consulta (Custo Fixo: R$ 12,00)</label>
                            <select id="consulta-type-select" class="input-field"></select>
                        </div>
                        <div class="form-group">
                            <label for="consulta-doc-input">CPF ou CNPJ para Consultar</label>
                            <input type="text" id="consulta-doc-input" class="input-field" placeholder="Digite o documento aqui" required>
                        </div>
                        <button type="submit" class="form-button">Pagar e Consultar</button>
                    </form>
                </div>
            </div>
            
            <div id="partner-planos-view" class="partner-view-content" style="display: none;">
                <div class="plans-container">
                    <div class="plan-card">
                        <h3>Essencial</h3>
                        <p class="description">Proteção para o seu CPF</p>
                        <div class="plan-price">
                            <span class="currency">R$</span><span class="amount">14,90</span><span class="period">/mês</span>
                        </div>
                        <ul class="plan-features">
                            <li><svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"></path></svg>Monitoramento de CPF 24h com alertas</li>
                            <li><svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"></path></svg>Relatório de Score detalhado</li>
                            <li><svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"></path></svg>Acesso a ofertas exclusivas de negociação</li>
                            <li><svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"></path></svg>1 Consulta CPF ou CNPJ</li>
                        </ul>
                        <a href="#" class="plan-button secondary">Começar com Essencial</a>
                    </div>
                    <div class="plan-card popular">
                        <div class="plan-badge">Mais Popular</div>
                        <h3>Plus</h3>
                        <p class="description">Sua saúde financeira completa</p>
                        <div class="plan-price">
                            <span class="currency">R$</span><span class="amount">29,90</span><span class="period">/mês</span>
                        </div>
                        <ul class="plan-features">
                            <li><svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"></path></svg>Tudo do Plano Essencial, e mais:</li>
                            <li><svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"></path></svg>Plano de Ação para <strong>Aumentar Score</strong></li>
                            <li><svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"></path></svg>Ferramenta de <strong>Orçamento Pessoal</strong></li>
                            <li><svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"></path></svg>Canal de <strong>Atendimento Prioritário</strong></li>
                            <li><svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"></path></svg>2 Consultas CPF ou CNPJ</li>
                        </ul>
                        <a href="#" class="plan-button primary">Escolher Plano Plus</a>
                    </div>
                    <div class="plan-card">
                        <h3>Premium</h3>
                        <p class="description">Consultoria e suporte VIP</p>
                        <div class="plan-price">
                            <span class="currency">R$</span><span class="amount">79,90</span><span class="period">/mês</span>
                        </div>
                        <ul class="plan-features">
                            <li><svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"></path></svg>Tudo do Plano Plus, e mais:</li>
                            <li><svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"></path></svg>Consultoria Financeira Pessoal (2x/mês)</li>
                            <li><svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"></path></svg>Assistente Pessoal para Negociação de Dívidas</li>
                            <li><svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"></path></svg>Relatório Financeiro Completo e Personalizado</li>
                            <li><svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"></path></svg>4 Consultas CPF ou CNPJ</li>
                        </ul>
                        <a href="#" class="plan-button secondary">Assinar Premium</a>
                    </div>
                </div>
            </div>

            <div id="partner-pacotes-view" class="partner-view-content" style="display: none;">
                <div class="plans-container" style="align-items: stretch;">
                    <div class="plan-card">
                        <h3 style="font-size: 1.2em; margin-bottom: 20px;">Consultas Avulsas</h3>
                        <div class="form-group" style="flex-grow: 1;">
                            <label for="consultas-qty-select" style="margin-bottom: 10px;">Escolha a quantidade:</label>
                            <select id="consultas-qty-select" class="input-field">
                                <option value="" disabled selected>Selecione uma opção</option>
                                <option value="300.00">1 unidade - R$ 300,00</option>
                                <option value="840.00">3 unidades - R$ 280,00 cada</option>
                                <option value="1300.00">5 unidades - R$ 260,00 cada</option>
                                <option value="2000.00">10 unidades - R$ 200,00 cada</option>
                            </select>
                        </div>
                        <a href="#" id="buy-consultas-btn" class="plan-button primary" style="margin-top: 24px;">Comprar</a>
                    </div>
                    <div class="plan-card">
                        <h3 style="font-size: 1.2em;">Limpeza Bacen 💳</h3>
                        <p class="description" style="min-height: auto; margin-bottom: 15px; flex-grow: 1;"><strong>Prazo:</strong> 60 a 90 dias úteis</p>
                        <div class="plan-price">
                            <span class="currency" style="font-size: 1.2em;">R$</span><span class="amount" style="font-size: 2.5em;">2.300,00</span>
                        </div>
                        <a href="#" class="plan-button primary buy-package-btn" data-valor="2300.00" data-servico="Limpeza Bacen">Comprar</a>
                    </div>
                    <div class="plan-card">
                        <h3 style="font-size: 1.2em;">Rating de crédito 📊</h3>
                        <p class="description" style="min-height: auto; margin-bottom: 15px; flex-grow: 1;"><strong>Prazo:</strong> 45 dias úteis</p>
                        <div class="plan-price">
                            <span class="currency" style="font-size: 1.2em;">R$</span><span class="amount" style="font-size: 2.5em;">1.400,00</span>
                        </div>
                        <a href="#" class="plan-button primary buy-package-btn" data-valor="1400.00" data-servico="Rating de Credito">Comprar</a>
                    </div>
                    <div class="plan-card">
                        <h3 style="font-size: 1.2em;">Aumento de score 🏆</h3>
                        <p class="description" style="min-height: auto; margin-bottom: 15px; flex-grow: 1;"><strong>Prazo:</strong> 20 dias úteis</p>
                        <div class="plan-price">
                            <span class="currency" style="font-size: 1.2em;">R$</span><span class="amount" style="font-size: 2.5em;">900,00</span>
                        </div>
                        <a href="#" class="plan-button primary buy-package-btn" data-valor="900.00" data-servico="Aumento de Score">Comprar</a>
                    </div>
                    <div class="plan-card">
                        <h3 style="font-size: 1.2em;">Limpeza Jus Brasil (Google) 📱</h3>
                        <p class="description" style="min-height: auto; margin-bottom: 15px; flex-grow: 1;"><strong>Prazo:</strong> 7 dias úteis</p>
                        <div class="plan-price">
                            <span class="amount" style="font-size: 2.5em;">Orçar 🤝</span>
                        </div>
                        <a href="https://wa.me/5511995688690?text=Ol%C3%A1%2C%20gostaria%20de%20um%20or%C3%A7amento%20para%20a%20Limpeza%20Jus%20Brasil." target="_blank" class="plan-button secondary">Solicitar Orçamento</a>
                    </div>
                </div>
            </div>

            <div id="partner-materiais-view" class="partner-view-content" style="display: none;">
                 <div class="dashboard-card" style="text-align: center;">
                    <h2>Acesso Rápido</h2>
                    <p style="color: var(--text-light); margin-bottom: 30px;">Acesse aqui os contratos e materiais de divulgação para parceiros.</p>
                     <div style="display: flex; flex-wrap: wrap; justify-content: center; gap: 20px;">
                        <a href="https://drive.google.com/drive/folders/1p6I896omKwRoYH9zkTP--zgyQu9H_eSo?usp=drive_link" target="_blank" class="plan-button primary" style="max-width: 250px;">
                            Ver Contratos
                        </a>
                        <a href="https://drive.google.com/drive/folders/1dxPdOP-bF1VkKHtD1JIzc0Z9WkmTV0nO?usp=drive_link" target="_blank" class="plan-button secondary" style="max-width: 250px;">
                            Material de Divulgação
                        </a>
                     </div>
                </div>
            </div>
        </main>
    </div>

    <div id="menu-overlay"></div>

    <div id="payment-modal" class="modal-overlay">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2 id="modal-title">Pagamento via PIX</h2>
            <p id="modal-description">Escaneie o QR Code ou copie o código abaixo.</p>
            <div id="qrcode-container"></div>
            <div class="pix-copy-area">
                <input type="text" id="pix-code" readonly>
                <button id="copy-pix-btn">Copiar</button>
            </div>
            <a href="https://wa.me/5511995688690?text=Estou%20enviando%20o%20comprovante%20da%20consulta!" id="whatsapp-link" target="_blank" class="whatsapp-button">Enviar Comprovante</a>
        </div>
    </div>

    <script>
        // BANCO DE DADOS INTEGRADO
        const clientDatabase = {
            // Clientes de exemplo com o novo formato de histórico
            "11122233344": { 
                name: "CLIENTE TESTE PENDENTE", 
                status: "EM TRANSIÇÃO DE ENVIO", 
                historicoPagamentos: [
                    { valor: "250,00", data: "2025-07-05", referencia: "Entrada", status: 'pago' },
                    { valor: "150,00", data: "2025-08-05", referencia: "Parcela 02/06", status: 'pendente' }
                ],
                materiais: [{ nome: "Guia", url: "#" }, { nome: "Contrato", url: "#" }] 
            },
            "22233344455": { 
                name: "CLIENTE TESTE EM DIA", 
                status: "LIMINAR CONCEDIDA", 
                historicoPagamentos: [
                    { valor: "250,00", data: "2025-07-01", referencia: "Entrada", status: 'pago' }, 
                    { valor: "150,00", data: "2025-08-01", referencia: "Parcela 01/06", status: 'pago' }
                ],
                materiais: [{ nome: "Guia", url: "#" }] 
            },
            "44455566677": { 
                name: "CLIENTE FINALIZADO", 
                status: "PROCESSO FINALIZADO", 
                historicoPagamentos: [
                    { valor: "250,00", data: "2025-06-10", referencia: "Entrada", status: 'pago' }, 
                    { valor: "150,00", data: "2025-07-10", referencia: "Parcela 01/06", status: 'pago' }, 
                    { valor: "150,00", data: "2025-08-10", referencia: "Parcela 02/06", status: 'pago' }
                ],
                materiais: [{ nome: "Guia", url: "#" }] 
            },
            "55566677788": { 
                name: "CLIENTE REPROTOCOLADO", 
                status: "RE-PROTOCOLO EMITIDO", 
                historicoPagamentos: [
                    { valor: "250,00", data: "2025-05-15", referencia: "Entrada", status: 'pago' },
                    { valor: "100,00", data: "2025-08-20", referencia: "Taxa", status: 'pendente' }
                ],
                materiais: [{ nome: "Guia", url: "#" }] 
            },
            "43550741880": { 
                name: "CAROLINE DOS SANTOS SOUSA BONFIM", 
                status: "AGUARDANDO DECISÃO-ATUALIZAÇÃO", 
                historicoPagamentos: [
                    { valor: "212,50", data: "10/09/2025", referencia: "Entrada", status: 'pendente' }, 
                    { valor: "212,50", data: "10/10/2025", referencia: "Entrada", status: 'pendente' }, 
                    { valor: "425,00", data: "10/11/2025", referencia: "Entrada", status: 'pendente' },
                    { valor: "85,00", data: "10/12/2025", referencia: "Parcela", status: 'pendente' },
                    { valor: "85,00", data: "10/01/2026", referencia: "Parcela", status: 'pendente' },
                    { valor: "85,00", data: "10/02/2026", referencia: "Parcela", status: 'pendente' },
                    { valor: "85,00", data: "10/03/2026", referencia: "Parcela", status: 'pendente' },
                    { valor: "85,00", data: "10/04/2026", referencia: "Parcela", status: 'pendente' },
                    { valor: "85,00", data: "10/05/2026", referencia: "Parcela", status: 'pendente' },
                    { valor: "85,00", data: "10/06/2026", referencia: "Parcela", status: 'pendente' },
                    { valor: "85,00", data: "10/07/2026", referencia: "Parcela", status: 'pendente' },
                    { valor: "85,00", data: "10/08/2026", referencia: "Parcela", status: 'pendente' },
                    { valor: "85,00", data: "10/09/2026", referencia: "Parcela", status: 'pendente' },
                    { valor: "85,00", data: "10/10/2026", referencia: "Parcela", status: 'pendente' },
                    { valor: "85,00", data: "10/11/2026", referencia: "Parcela", status: 'pendente' },
                ],
                materiais: [{ nome: "Guia", url: "#" }] 
            },
            "15155777836": { 
                name: "JECICA ALESSANDRA DO CARMO", 
                status: "AGUARDANDO DECISÃO-ATUALIZAÇÃO", 
                historicoPagamentos: [
                    { valor: "200,00", data: "04/09/2025", referencia: "Entrada", status: 'pago' }, 
                    { valor: "200,00", data: "04/10/2025", referencia: "Entrada", status: 'pendente' }, 
                    { valor: "200,00", data: "04/11/2025", referencia: "Entrada", status: 'pendente' }, 
                    { valor: "200,00", data: "04/12/2025", referencia: "Entrada", status: 'pendente' }, 
                    { valor: "200,00", data: "04/01/2026", referencia: "Entrada", status: 'pendente' }, 
                    { valor: "200,00", data: "04/02/2026", referencia: "Parcela", status: 'pendente' }, 
                    { valor: "200,00", data: "04/03/2026", referencia: "Parcela", status: 'pendente' }, 
                    { valor: "200,00", data: "04/04/2026", referencia: "Parcela", status: 'pendente' }, 
                    { valor: "200,00", data: "04/05/2026", referencia: "Parcela", status: 'pendente' }, 
                    { valor: "200,00", data: "04/06/2026", referencia: "Parcela", status: 'pendente' }, 
                    { valor: "200,00", data: "04/07/2026", referencia: "Parcela", status: 'pendente' }, 
                    { valor: "200,00", data: "04/08/2026", referencia: "Parcela", status: 'pendente' }, 
                ],
                materiais: [{ nome: "Guia", url: "#" }] 
            },
            "12066187879": { 
                name: "ROSANA DE ALMEIDA", 
                status: "EM TRANSIÇÃO DE ENVIO", 
                historicoPagamentos: [
                    { valor: "200,00", data: "04/09/2025", referencia: "Entrada", status: 'pago' }, 
                    { valor: "200,00", data: "16/09/2025", referencia: "Entrada", status: 'pendente' }, 
                    { valor: "200,00", data: "04/10/2025", referencia: "Entrada", status: 'pendente' }, 
                    { valor: "200,00", data: "16/10/2025", referencia: "Entrada", status: 'pendente' }, 
                    { valor: "200,00", data: "04/11/2025", referencia: "Entrada", status: 'pendente' }, 
                    { valor: "250,00", data: "04/12/2025", referencia: "Parcela", status: 'pendente' }, 
                    { valor: "250,00", data: "04/01/2026", referencia: "Parcela", status: 'pendente' }, 
                    { valor: "250,00", data: "04/02/2026", referencia: "Parcela", status: 'pendente' }, 
                    { valor: "250,00", data: "04/03/2026", referencia: "Parcela", status: 'pendente' }, 
                    { valor: "250,00", data: "04/04/2026", referencia: "Parcela", status: 'pendente' }, 
                    { valor: "250,00", data: "04/05/2026", referencia: "Parcela", status: 'pendente' }, 
                    { valor: "250,00", data: "04/06/2026", referencia: "Parcela", status: 'pendente' },
                    { valor: "250,00", data: "04/07/2026", referencia: "Parcela", status: 'pendente' },
                    { valor: "250,00", data: "04/08/2026", referencia: "Parcela", status: 'pendente' },
                    { valor: "250,00", data: "04/09/2026", referencia: "Parcela", status: 'pendente' },
                    { valor: "250,00", data: "04/10/2026", referencia: "Parcela", status: 'pendente' },
                    { valor: "250,00", data: "04/11/2026", referencia: "Parcela", status: 'pendente' }, 
                ],
                materiais: [{ nome: "Guia", url: "#" }]
            },
            "33643827865": { 
                name: "CARINA CARDOSO DA SILVA", 
                status: "EM TRANSIÇÃO DE ENVIO", 
                historicoPagamentos: [
                    { valor: "500,00", data: "04/09/2025", referencia: "Entrada", status: 'pendente' }, 
                    { valor: "500,00", data: "15/10/2025", referencia: "Entrada", status: 'pendente' }, 
                    { valor: "250,00", data: "15/11/2025", referencia: "Parcela", status: 'pendente' }, 
                    { valor: "250,00", data: "15/12/2025", referencia: "Parcela", status: 'pendente' }, 
                    { valor: "250,00", data: "15/01/2026", referencia: "Parcela", status: 'pendente' }, 
                    { valor: "250,00", data: "15/02/2025", referencia: "Parcela", status: 'pendente' }, 
                    { valor: "250,00", data: "15/03/2026", referencia: "Parcela", status: 'pendente' }, 
                    { valor: "250,00", data: "15/04/2026", referencia: "Parcela", status: 'pendente' }, 
                    { valor: "250,00", data: "15/05/2026", referencia: "Parcela", status: 'pendente' }, 
                    { valor: "250,00", data: "15/06/2026", referencia: "Parcela", status: 'pendente' }, 
                    { valor: "250,00", data: "15/07/2026", referencia: "Parcela", status: 'pendente' }, 
                    { valor: "250,00", data: "15/08/2026", referencia: "Parcela", status: 'pendente' },
                    { valor: "250,00", data: "15/09/2026", referencia: "Parcela", status: 'pendente' },
                    { valor: "250,00", data: "15/10/2026", referencia: "Parcela", status: 'pendente' },
                ],
                materiais: [{ nome: "Guia", url: "#" }] 
            },
            "42123397814": { name: "MICHELE CRISTINA DE ANDRADE ", status: "LIMINAR CONCEDIDA", historicoPagamentos: [], materiais: [{ nome: "Guia de Boas-Vindas", url: "https://drive.google.com/file/d/1htO_aC0lZq8Hm_LBTIqmXCdTGq4u0gHY/view?usp=drive_link" }, { nome: "Como funciona", url: "https://drive.google.com/file/d/19L0CiDVownobfknYDABMCLkLiqG4F2H4/view?usp=drive_link" }] },
            "55092816856": { name: "Helena Cristina Ramos Rocha ", status: "EM TRANSIÇÃO DE ENVIO", historicoPagamentos: [], materiais: [{ nome: "Guia de Boas-Vindas", url: "https://drive.google.com/file/d/1htO_aC0lZq8Hm_LBTIqmXCdTGq4u0gHY/view?usp=drive_link" }, { nome: "Como funciona", url: "https://drive.google.com/file/d/19L0CiDVownobfknYDABMCLkLiqG4F2H4/view?usp=drive_link" }] },
            "30888356889": { name: "Angélica aparecida da Silva ", status: "AGUARDANDO DECISÃO-ATUALIZAÇÃO", historicoPagamentos: [], materiais: [{ nome: "Guia de Boas-Vindas", url: "https://drive.google.com/file/d/1htO_aC0lZq8Hm_LBTIqmXCdTGq4u0gHY/view?usp=drive_link" }, { nome: "Como funciona", url: "https://drive.google.com/file/d/19L0CiDVownobfknYDABMCLkLiqG4F2H4/view?usp=drive_link" }] },
        };

        const announcements = [ { title: "📢 Novidades a Caminho!", text: "Em breve, lançaremos novos planos de monitoramento financeiro. Aguarde!" }, { title: "💡 Cartão de crédito", text: "Destrave o melhor cartão para negativados do BRASIL !" }, { title: "🔒 Sua Segurança", text: "Nunca compartilhe sua senha. Nossa equipe jamais solicitará suas credenciais." } ];
        let currentAnnouncementIndex = 0, announcementInterval = null, activeClientData = null;

        document.addEventListener('DOMContentLoaded', () => {
            const loginScreen = document.getElementById('login-screen');
            const errorMessage = document.getElementById('error-message');
            const docInput = document.getElementById('docInput');
            const passwordInput = document.getElementById('passwordInput');
            const loginButton = document.getElementById('loginButton');
            const clientAppLayout = document.getElementById('app-layout');
            const adminDashboardView = document.getElementById('admin-dashboard-view');
            const partnerDashboardView = document.getElementById('partner-dashboard-view');
            const menuOverlay = document.getElementById('menu-overlay');

            loginButton.addEventListener('click', () => {
                const userInput = docInput.value.trim();
                const password = passwordInput.value;
                const docNumber = userInput.replace(/\D/g, '');
                const expectedClientPassword = docNumber.substring(0, 4);

                if (userInput === 'admin' && password === '0000') {
                    loginScreen.style.display = 'none';
                    adminDashboardView.style.display = 'block';
                    clientAppLayout.style.display = 'none';
                    partnerDashboardView.style.display = 'none';
                    renderAdminDashboard();
                } else if (userInput === 'parceiro' && password === 'parceiro123') {
                    loginScreen.style.display = 'none';
                    adminDashboardView.style.display = 'none';
                    clientAppLayout.style.display = 'none';
                    partnerDashboardView.style.display = 'grid'; // Usa 'grid' para o layout principal
                    setupPartnerDashboard();
                } else if (clientDatabase.hasOwnProperty(docNumber) && password === expectedClientPassword) {
                    activeClientData = { ...clientDatabase[docNumber], doc: docNumber };
                    loginScreen.style.display = 'none';
                    adminDashboardView.style.display = 'none';
                    partnerDashboardView.style.display = 'none';
                    clientAppLayout.style.display = 'grid'; // Usa 'grid'
                    setupUIForUser(activeClientData);
                } else {
                    errorMessage.textContent = 'Credenciais inválidas.';
                }
            });

            function performLogout() {
                adminDashboardView.style.display = 'none';
                clientAppLayout.style.display = 'none';
                partnerDashboardView.style.display = 'none';
                loginScreen.style.display = 'flex';
                docInput.value = ''; passwordInput.value = '';
                errorMessage.textContent = '';
                if (announcementInterval) clearInterval(announcementInterval);
            }
            
            document.getElementById('admin-logout-btn').addEventListener('click', (e) => { e.preventDefault(); performLogout(); });
            function renderAdminDashboard() {
                const clients = Object.entries(clientDatabase);
                const totalClients = clients.length;
                const pendingClients = clients.filter(([, data]) => data.status === 'EM TRANSIÇÃO DE ENVIO').length;
                const finishedClients = clients.filter(([, data]) => data.status === 'PROCESSO FINALIZADO').length;
                let revenuePending = 0, revenueReceived = 0;
                clients.forEach(([, data]) => {
                    if (data.historicoPagamentos) {
                        data.historicoPagamentos.forEach(p => {
                            const valor = parseFloat(p.valor.replace(',', '.'));
                            if (p.status === 'pendente') revenuePending += valor;
                            else if (p.status === 'pago') revenueReceived += valor;
                        });
                    }
                });
                document.getElementById('kpi-total-clients').textContent = totalClients;
                document.getElementById('kpi-pending-clients').textContent = pendingClients;
                document.getElementById('kpi-finished-clients').textContent = finishedClients;
                document.getElementById('kpi-revenue-pending').textContent = revenuePending.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
                renderFinancialChart(revenueReceived, revenuePending);
                renderClientTable(clients);
            }
            function renderFinancialChart(received, pending) {
                const ctx = document.getElementById('financial-chart').getContext('2d');
                if (window.myFinancialChart) window.myFinancialChart.destroy();
                window.myFinancialChart = new Chart(ctx, {
                    type: 'doughnut', data: { labels: ['Recebidas', 'A Receber'], datasets: [{ data: [received, pending], backgroundColor: ['#10b981', '#f59e0b'], borderWidth: 1 }] },
                    options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'top' }, tooltip: { callbacks: { label: c => `${c.label}: ${c.parsed.toLocaleString('pt-BR', {style: 'currency', currency: 'BRL'})}` } } } }
                });
            }
            function renderClientTable(clients) {
                const tableBody = document.querySelector('#client-table tbody');
                tableBody.innerHTML = '';
                clients.forEach(([id, data]) => {
                    const row = tableBody.insertRow();
                    const hasPendingPayment = data.historicoPagamentos && data.historicoPagamentos.some(p => p.status === 'pendente');
                    const paymentStatusHTML = hasPendingPayment ? `<span class="payment-status-pending">Pendente</span>` : `<span class="payment-status-ok">Em dia</span>`;
                    row.innerHTML = `<td data-label="Cliente">${data.name}</td><td data-label="Documento">${id}</td><td data-label="Status">${data.status}</td><td data-label="Pagamento">${paymentStatusHTML}</td><td data-label="Links" class="client-links">${(data.materiais || []).map(l => `<a href="${l.url}" target="_blank">${l.nome}</a>`).join('')}</td>`;
                });
            }
            document.getElementById('search-input').addEventListener('keyup', (e) => {
                const searchTerm = e.target.value.toLowerCase();
                document.querySelectorAll('#client-table tbody tr').forEach(row => {
                    row.style.display = row.textContent.toLowerCase().includes(searchTerm) ? '' : 'none';
                });
            });

            function setupUIForUser(userData) {
                const sidebar = clientAppLayout.querySelector('.sidebar');
                document.getElementById('username-display').textContent = userData.name.split(' ')[0];
                document.getElementById('client-nav-ul').innerHTML = `
                    <li><a href="#" class="nav-link" data-view="dashboard-view"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/></svg>Dashboard</a></li>
                    <li><a href="#" class="nav-link" data-view="payments-view"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H4a3 3 0 00-3 3v8a3 3 0 003 3z"></path></svg>Pagamentos</a></li>
                    <li><a href="#" class="nav-link" data-view="consultas-view"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>Consultas</a></li>
                    <li><a href="#" class="nav-link" data-view="plans-view"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>Planos</a></li>
                    <li><a href="#" class="nav-link" data-view="credit-card-view"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H4a3 3 0 00-3 3v8a3 3 0 003 3z"/></svg>Cartão de Crédito</a></li>
                `;
                addNavListeners(clientAppLayout, '#client-nav-ul .nav-link', '.view-content', '#page-title');
                populateDashboard(userData); populatePaymentsView(userData); populateConsultasView(); populatePlansView(); populateCreditCardView();
                document.querySelector('#client-nav-ul .nav-link').click();

                const toggleClientMobileMenu = () => { sidebar.classList.toggle('open'); menuOverlay.classList.toggle('open'); };
                document.getElementById('client-mobile-menu-button').onclick = toggleClientMobileMenu;
                document.getElementById('client-close-menu-button').onclick = toggleClientMobileMenu;
                clientAppLayout.querySelector('.logout-button').addEventListener('click', performLogout);
            }
            function addNavListeners(parentLayout, linkSelector, viewSelector, titleSelector) {
                const navLinks = parentLayout.querySelectorAll(linkSelector);
                navLinks.forEach(link => {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        navLinks.forEach(item => item.classList.remove('active'));
                        link.classList.add('active');
                        parentLayout.querySelectorAll(viewSelector).forEach(view => view.style.display = 'none');
                        document.getElementById(link.dataset.view).style.display = 'block';
                        parentLayout.querySelector(titleSelector).textContent = link.textContent.trim();
                        const sidebar = parentLayout.querySelector('.sidebar');
                        if (sidebar.classList.contains('open')) {
                             sidebar.classList.remove('open');
                             menuOverlay.classList.remove('open');
                        }
                    });
                });
            }
            function populateDashboard(clientData) {
                const dashboardContainer = document.getElementById('dashboard-view');
                const nextPayment = clientData.historicoPagamentos ? clientData.historicoPagamentos.find(p => p.status === 'pendente') : null;
                dashboardContainer.innerHTML = `<section class="summary-cards"><div class="summary-card"><div class="icon" style="background-color: #dbeafe; color: #3b82f6;"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg></div><div class="text"><h3>Status do Processo</h3><p>${clientData.status.replace(/-/g, ' ')}</p></div></div><div class="summary-card"><div class="icon" style="background-color: #fef3c7; color: #f59e0b;"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg></div><div class="text"><h3>Próxima Parcela</h3><p>${nextPayment ? nextPayment.data : "Em dia"}</p></div></div><div class="summary-card"><div class="icon" style="background-color: #d1fae5; color: #10b981;"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path></svg></div><div class="text"><h3>Materiais</h3><p>${(clientData.materiais || []).length} Arquivos</p></div></div></section><section class="dashboard-card announcement-card"><h2 id="announcement-title"></h2><p id="announcement-text"></p></section><section class="dashboard-grid"><div class="dashboard-card"><h2>Andamento da Liminar</h2><div id="timeline-container"></div></div><div class="dashboard-card"><h2>Meus Materiais</h2><ul id="materiais-list"></ul></div></section>`;
                const statusInfo = getStatusInfo(clientData.status);
                const timelineContainer = document.getElementById('timeline-container');
                const steps = [{ title: 'Análise', description: 'Documentos em análise.', icon: '<svg viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6z"/><path d="M14 2v6h6"/><path d="M12 18a4 4 0 1 0 0-8 4 4 0 0 0 0 8z"/><path d="m22 22-3-3"/></svg>' },{ title: 'Processo', description: 'Ação protocolada.', icon: '<svg viewBox="0 0 24 24"><path d="M16 22h2a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v3"/><path d="M14 2v4a2 2 0 0 0 2 2h4"/><path d="M4.26 10.05A6.5 6.5 0 0 0 8 16.5c1.93 0 3.68-.93 4.74-2.45"/><path d="M12 12V6.5"/><path d="M12 22a1 1 0 0 0 1-1v-2.5a.5.5 0 0 0-.5-.5.5.5 0 0 1-.5-.5V17a1 1 0 0 0-1-1h-2a1 1 0 0 0-1 1v1.5a.5.5 0 0 1-.5.5.5.5 0 0 0-.5.5V21a1 1 0 0 0 1 1z"/></svg>' },{ title: 'Notificação', description: 'Liminar concedida!', icon: '<svg viewBox="0 0 24 24"><path d="M22 17a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v10z"/><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/></svg>' },{ title: 'Finalizado', description: 'Processo concluído.', icon: '<svg viewBox="0 0 24 24"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/><path d="m9 12 2 2 4-4"/></svg>' }];
                timelineContainer.innerHTML = `<div class="timeline"><div id="progress-bar"></div>${steps.map((step, index) => `<div class="step ${index + 1 === statusInfo.step ? 'active' : ''} ${index + 1 < statusInfo.step ? 'completed' : ''}"><div class="step-icon">${step.icon}</div><div class="step-content"><p class="step-title">${step.title}</p><p class="step-description">${step.description}</p></div></div>`).join('')}</div><div id="status-message">${statusInfo.message}</div>`;
                updateTimelineProgressBar(statusInfo.step, steps.length);
                document.getElementById('materiais-list').innerHTML = (clientData.materiais || []).map(m => `<li><a href="${m.url}" target="_blank">📄 ${m.nome}</a></li>`).join('');
                showNextAnnouncement();
                announcementInterval = setInterval(showNextAnnouncement, 7000);
            }
            function populatePaymentsView(clientData) {
                const container = document.getElementById('payments-view');
                if (clientData.historicoPagamentos && clientData.historicoPagamentos.length > 0) {
                    let tableRowsHTML = clientData.historicoPagamentos.map(pagamento => {
                        const isPendente = pagamento.status === 'pendente';
                        const statusClass = isPendente ? 'status-pendente' : 'status-pago';
                        const statusText = isPendente ? 'Pendente' : 'Pago';
                        const actionButton = isPendente ? `<button class="regularizar-btn" data-valor="${pagamento.valor}" data-referencia="${pagamento.referencia}">Regularizar</button>`: '✔';
                        return `<tr><td>${pagamento.referencia}</td><td>${pagamento.data}</td><td>R$ ${pagamento.valor}</td><td><span class="status-badge ${statusClass}">${statusText}</span></td><td>${actionButton}</td></tr>`;
                    }).join('');
                    container.innerHTML = `<div class="payment-history-card"><h2>Histórico de Pagamentos</h2><div class="history-table-container"><table class="payment-history-table"><thead><tr><th>Referência</th><th>Data</th><th>Valor</th><th>Status</th><th>Ação</th></tr></thead><tbody>${tableRowsHTML}</tbody></table></div></div>`;
                    document.querySelectorAll('.regularizar-btn').forEach(button => {
                        button.addEventListener('click', () => {
                            const valor = button.dataset.valor;
                            const referencia = button.dataset.referencia;
                            const doc = activeClientData.doc;
                            handlePixPayment(valor, `REG-${doc.substring(0,5)}-${referencia.substring(0,3)}`, `Pagamento: ${referencia}`);
                        });
                    });
                } else {
                    container.innerHTML = `<div class="payment-card ok"><h3>🎉 Tudo em dia por aqui!</h3><div class="no-payments-message"><p>Nenhum histórico de pagamento encontrado.</p></div></div>`;
                }
            }
            function populateConsultasView() {
                document.getElementById('consultas-view').innerHTML = `<div class="payment-card consulta-card"><h3>Consultar CPF ou CNPJ</h3><p>Custo de <strong>R$ 8,00</strong> por consulta. Preencha os dados, realize o pagamento e a solicitação será enviada.</p><form id="consulta-form"><input type="hidden" name="solicitante_nome" value="${activeClientData.name}"><input type="hidden" name="solicitante_doc" value="${activeClientData.doc}"><div class="form-group"><label for="doc_a_consultar">CPF ou CNPJ para consulta</label><input type="text" id="doc_a_consultar" name="doc_a_consultar" class="input-field" required></div><button type="submit" class="form-button">Solicitar e Pagar R$ 8,00</button></form><div id="form-status"></div></div>`;
                document.getElementById('consulta-form').addEventListener('submit', handleFormSubmit);
            }
            async function handleFormSubmit(event) {
                event.preventDefault();
                const form = event.target; const data = new FormData(form); const statusDiv = document.getElementById('form-status');
                statusDiv.textContent = 'Enviando solicitação...'; statusDiv.style.color = 'var(--text-light)';
                try {
                    const response = await fetch('https://formspree.io/f/xandlqrb', { method: 'POST', body: data, headers: { 'Accept': 'application/json' } });
                    if (response.ok) {
                        statusDiv.textContent = 'Solicitação enviada! Gerando PIX...';
                        statusDiv.style.color = 'var(--success-color)'; form.reset();
                        setTimeout(() => handlePixPayment('8.00', `CONSULTA-${data.get('doc_a_consultar').substring(0,5)}`, 'Taxa de Consulta'), 1000);
                    } else { throw new Error('Erro no servidor.'); }
                } catch (error) { statusDiv.textContent = 'Houve um erro. Tente novamente.'; statusDiv.style.color = 'var(--danger-color)'; }
            }
            function populatePlansView() {
                const plansContainer = document.getElementById('plans-view'); const checkIcon = `<svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"></path></svg>`;
                plansContainer.innerHTML = `<p style="text-align: center; margin-bottom: 40px; font-size: 1.1em; color: var(--text-dark);">Compare os benefícios e veja como podemos proteger e impulsionar sua vida financeira com monitoramento contínuo.</p><div class="plans-container"><div class="plan-card"><h3>Essencial</h3><p class="description">Proteção para o seu CPF</p><div class="plan-price"><span class="currency">R$</span><span class="amount">14,90</span><span class="period">/mês</span></div><ul class="plan-features"><li>${checkIcon}Monitoramento de CPF 24h com alertas</li><li>${checkIcon}Relatório de Score detalhado</li><li>${checkIcon}Acesso a ofertas exclusivas de negociação</li><li>${checkIcon}1 Consultas CPF ou CNPJ</li></ul><a href="#" class="plan-button secondary">Começar com Essencial</a></div><div class="plan-card popular"><div class="plan-badge">Mais Popular</div><h3>Plus</h3><p class="description">Sua saúde financeira completa</p><div class="plan-price"><span class="currency">R$</span><span class="amount">29,90</span><span class="period">/mês</span></div><ul class="plan-features"><li>${checkIcon}Tudo do Essencial, e mais:</li><li>${checkIcon}Plano de Ação para <strong style="color:var(--primary-color);">Aumentar Score</strong></li><li>${checkIcon}Ferramenta de <strong style="color:var(--primary-color);">Orçamento Pessoal</strong></li><li>${checkIcon}Canal de <strong style="color:var(--primary-color);">Atendimento Prioritário</strong></li><li>${checkIcon}2 Consultas CPF ou CNPJ</li></ul><a href="#" class="plan-button primary">Escolher Plano Plus</a></div><div class="plan-card"><h3>Premium</h3><p class="description">Consultoria e suporte VIP</p><div class="plan-price"><span class="currency">R$</span><span class="amount">79,90</span><span class="period">/mês</span></div><ul class="plan-features"><li>${checkIcon}Tudo do Plano Plus, e mais:</li><li>${checkIcon}Consultoria Financeira Pessoal <br>(2x/mês)</li><li>${checkIcon}Assistente Pessoal para Negociação de Dívidas</li><li>${checkIcon}Relatório Financeiro Completo e Personalizado</li><li>${checkIcon}4 Consultas CPF ou CNPJ</li></ul><a href="#" class="plan-button secondary">Assinar Premium</a></div></div>`;
            }
            function getStatusInfo(statusName) {
                const statuses = { "EM TRANSIÇÃO DE ENVIO": { step: 1, message: "Sua documentação foi recebida e está na fila para análise judicial." }, "LIMINAR CONCEDIDA": { step: 3, message: "Decisão judicial favorável! Agora entra na fase de notificar os órgãos de crédito." }, "AGUARDANDO DECISÃO-ATUALIZAÇÃO": { step: 3, message: "Aguardando os órgãos de crédito cumprirem a decisão judicial." }, "RE-PROTOCOLO EMITIDO": { step: 2, message: "Documentação re-emitida e protocolada." }, "PROCESSO FINALIZADO": { step: 4, message: "Parabéns! Seu processo foi concluído com sucesso." } };
                return statuses[statusName] || { step: 0, message: "Status não encontrado." };
            }
            function updateTimelineProgressBar(currentStep, totalSteps) {
                const progressBar = document.getElementById('progress-bar'); if (!progressBar) return; const progress = currentStep > 1 ? ((currentStep - 1) / (totalSteps - 1)) * 80 + 10 : 0; if (window.innerWidth <= 768) { progressBar.style.height = `${(currentStep-1)*33.3}%`; } else { progressBar.style.width = `${progress}%`; }
            }
            function showNextAnnouncement() {
                const card = document.querySelector('.announcement-card'); if (card) { card.classList.add('fading'); setTimeout(() => { const ann = announcements[currentAnnouncementIndex]; if (ann) { card.querySelector('h2').textContent = ann.title; card.querySelector('p').textContent = ann.text; } currentAnnouncementIndex = (currentAnnouncementIndex + 1) % announcements.length; card.classList.remove('fading'); }, 400); }
            }
            function populateCreditCardView() { /* ... Lógica do cartão de crédito ... */ }
            
            function setupPartnerDashboard() {
                const sidebar = partnerDashboardView.querySelector('.sidebar');
                document.getElementById('partner-username-display').textContent = 'Parceiro';
                
                document.getElementById('partner-nav-ul').innerHTML = `
                    <li><a href="#" class="partner-nav-link" data-view="partner-consultas-view"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>Consultas</a></li>
                    <li><a href="#" class="partner-nav-link" data-view="partner-planos-view"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0v-4m0 4h5m0 0v-4m0 4h5m0 0v-4"></path></svg>Planos</a></li>
                    <li><a href="#" class="partner-nav-link" data-view="partner-pacotes-view"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path></svg>Pacotes</a></li>
                    <li><a href="#" class="partner-nav-link" data-view="partner-materiais-view"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l-1.586-1.586a2 2 0 00-2.828 0L6 14m6-6l.01.01"></path><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect></svg>Materiais</a></li>
                `;
                
                const partnerConsultas = ["AÇÕES E PROCESSOS JUDICIAS CNPJ", "AVALIE CREDITO CNPJ", "AVALIE CREDITO CPF", "AÇÕES E PROCESSOS JUDICIAS CPF", "AVALIE CRÉDITO COMPLETA + SCORE CNPJ", "AVALIE CRÉDITO COMPLETA + SCORE CPF", "BOA VISTA + CADIN + SCORE CNPJ", "BOA VISTA + CADIN + SCORE CPF", "BOA VISTA + CENPROT + SCORE CNPJ", "BOA VISTA + CENPROT + SCORE CPF", "BOA VISTA + SCORE CNPJ", "BOA VISTA + SCORE CPF", "BOA VISTA SCPC CNPJ", "BOA VISTA SCPC CPF", "CADIN PGFN", "CCF + PROTESTO NACIONAL", "CONCENTRE RATING SCORE CPF", "CREDITO TOTAL + CENPROT CNPJ", "CONSULTA COMPLETA CPF / CNPJ", "CONSULTA COMPLETA PREMIUM CPF / CNPJ", "CREDITO TOTAL + SCORE CPF", "CREDITO TOTAL + SCORE CNPJ", "CREDITO TOTAL + CENPROT CPF", "CREDITO TOTAL CADIN + SCORE CNPJ", "CREDITO TOTAL CADIN + SCORE CPF", "DPA CNPJ + SCORE", "DPA CPF + SCORE", "PROTESTO NACIONAL", "PROTESTO NACIONAL + DADOS CADASTRAIS", "PROTESTO NACIONAL + DADOS CADASTRAIS + SCORE", "QUOD CNPJ", "QUOD CPF", "QUOD + SCORE CNPJ", "QUOD + SCORE CPF", "QUOD SCORE CNPJ + CADIN", "QUOD SCORE CPF + CADIN", "QUOD SCORE CNPJ + CENPROT", "QUOD SCORE CPF + CENPROT", "QUOD + BVS + CENPROT CPF/CNPJ", "RATING BANCARIO + SCORE CPF / CNPJ", "RELATÓRIO BASICO + SCORE CPF/CNPJ", "SCR + CREDITO TOTAL + SCORE CNPJ", "SCR + CREDITO TOTAL + SCORE CPF", "SCR + SCORE", "SER BVS + SCORE CNPJ", "SER BVS + SCORE CPF", "SER BVS CENPROT + SCORE CNPJ", "SER BVS CENPROT + SCORE CPF", "SER CNPJ", "SER+SCORE CPF", "SER CREDNET CPF / CNPJ", "SER + SPC + SCORE CNPJ", "SER + SPC +SCORE CPF", "SER PRIME + SCORE", "SER + CADIN SCORE CPF", "SER + CENPROT SCORE CPF", "SER + SPC + CADIN SCORE CNPJ", "SER + SPC + CADIN SCORE CPF", "SER + SPC + CENPROT SCORE CNPJ", "SER + SPC + CENPROT SCORE CPF"];
                document.getElementById('consulta-type-select').innerHTML = partnerConsultas.map(c => `<option value="${c}">${c}</option>`).join('');

                document.getElementById('partner-consulta-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    const docToQuery = document.getElementById('consulta-doc-input').value;
                    if (!docToQuery) { alert('Por favor, digite um documento para consultar.'); return; }
                    const price = "12.00";
                    const reference = `PARC-${docToQuery.replace(/\D/g, '').substring(0, 6)}`;
                    handlePixPayment(price, reference, `Consulta Parceiro`);
                });
                
                document.getElementById('buy-consultas-btn').addEventListener('click', (e) => {
                    e.preventDefault();
                    const select = document.getElementById('consultas-qty-select');
                    const valor = select.value;
                    const textoOpcao = select.options[select.selectedIndex].text;

                    if (!valor) {
                        alert('Por favor, selecione uma quantidade.');
                        return;
                    }
                    
                    const modalTitle = `Compra de ${textoOpcao}`;
                    const reference = `PACOTE-CONSULTA-${Date.now()}`;
                    handlePixPayment(valor, reference, modalTitle);
                });

                document.querySelectorAll('.buy-package-btn').forEach(button => {
                    button.addEventListener('click', e => {
                        e.preventDefault();
                        const valor = button.dataset.valor;
                        const servico = button.dataset.servico;
                        const modalTitle = `Compra de ${servico}`;
                        const reference = `PACOTE-${servico.replace(/\s+/g, '')}-${Date.now()}`;
                        handlePixPayment(valor, reference, modalTitle);
                    });
                });

                addNavListeners(partnerDashboardView, '.partner-nav-link', '.partner-view-content', '#partner-page-title');
                document.querySelector('#partner-nav-ul .partner-nav-link').click();

                const togglePartnerMobileMenu = () => { sidebar.classList.toggle('open'); menuOverlay.classList.toggle('open'); };
                document.getElementById('partner-mobile-menu-button').onclick = togglePartnerMobileMenu;
                document.getElementById('partner-close-menu-button').onclick = togglePartnerMobileMenu;
                document.getElementById('partner-logout-btn').addEventListener('click', performLogout);
            }

            menuOverlay.addEventListener('click', () => {
                document.querySelectorAll('.sidebar.open').forEach(s => s.classList.remove('open'));
                menuOverlay.classList.remove('open');
            });

            function handlePixPayment(amount, reference, modalTitle) {
                const amountAsNumber = parseFloat(amount.replace(',', '.')).toFixed(2);
                const modal = document.getElementById('payment-modal');
                const pixCodeInput = document.getElementById('pix-code');
                const copyBtn = document.getElementById('copy-pix-btn');
                document.getElementById('modal-title').textContent = modalTitle;
                document.getElementById('qrcode-container').innerHTML = '';
                const pixKey = "Contato.cobecode@gmail.com";
                const merchantName = "CMG CONSULTORIA";
                const merchantCity = "SAO PAULO";
                const txid = reference.replace(/[^a-zA-Z0-9]/g, '').substring(0, 25) || '***';
                const pixPayload = generatePixPayload(pixKey, amountAsNumber, txid, merchantName, merchantCity);
                pixCodeInput.value = pixPayload;
                new QRCode(document.getElementById('qrcode-container'), { text: pixPayload, width: 200, height: 200 });
                copyBtn.textContent = 'Copiar';
                copyBtn.onclick = () => { navigator.clipboard.writeText(pixCodeInput.value).then(() => { copyBtn.textContent = 'Copiado!'; }); };
                const whatsappMessage = `Olá! Envio o comprovante de: ${modalTitle}, no valor de R$ ${amount}.`;
                document.getElementById('whatsapp-link').href = `https://wa.me/5511995688690?text=${encodeURIComponent(whatsappMessage)}`;
                modal.style.display = 'flex';
                const closeModal = () => modal.style.display = 'none';
                modal.querySelector('.close-modal').onclick = closeModal;
                modal.onclick = (e) => { if (e.target === modal) closeModal(); };
            }
            function crc16(data) {
                let crc = 0xFFFF;
                for (let i = 0; i < data.length; i++) {
                    crc ^= data.charCodeAt(i) << 8;
                    for (let j = 0; j < 8; j++) {
                        crc = (crc & 0x8000) ? (crc << 1) ^ 0x1021 : crc << 1;
                    }
                }
                return ('0000' + (crc & 0xFFFF).toString(16).toUpperCase()).slice(-4);
            }
            function generatePixPayload(pixKey, amount, txid, merchantName, merchantCity) {
                const formatField = (id, value) => { const len = value.length.toString().padStart(2, '0'); return `${id}${len}${value}`; };
                const normalizeText = (text) => text.normalize("NFD").replace(/[\u0300-\u036f]/g, "").replace(/[^a-zA-Z0-9\s]/g, '').trim();
                const payloadFormat = '000201';
                const merchantAccountInfo = formatField('26', formatField('00', 'br.gov.bcb.pix') + formatField('01', pixKey));
                const merchantCategoryCode = '52040000';
                const transactionCurrency = '5303986';
                const transactionAmount = formatField('54', amount);
                const countryCode = '5802BR';
                const merchantNameFormatted = formatField('59', normalizeText(merchantName).substring(0, 25));
                const merchantCityFormatted = formatField('60', normalizeText(merchantCity).substring(0, 15));
                const additionalDataFormatted = formatField('62', formatField('05', txid));
                const payload = [payloadFormat, merchantAccountInfo, merchantCategoryCode, transactionCurrency, transactionAmount, countryCode, merchantNameFormatted, merchantCityFormatted, additionalDataFormatted].join('') + '6304';
                const checksum = crc16(payload);
                return payload + checksum;
            }
        });
    </script>
</body>
</html>